<!-- Extended Rest macro -->

[h: names = getSelectedNames("json")]
[h,if(json.length(names)!=1): abort(0)]
[h,if(json.get(names,0)!=getImpersonatedName()): abort(0)]

[h,foreach(index,getMacroGroup("Encounter Attacks")), code: 
{
  [h:macroStr=json.get(getMacroProps(index,"json"),"label")]
  [h,if(endsWith(macroStr,"(Used)")): setMacroProps(index, "label="+replace(macroStr, " \\(Used\\)", ""))]
}]
[h,foreach(index,getMacroGroup("Encounter Utilities")), code: 
{
  [h:macroStr=json.get(getMacroProps(index,"json"),"label")]
  [h,if(endsWith(macroStr,"(Used)")): setMacroProps(index, "label="+replace(macroStr, " \\(Used\\)", ""))]
}]
[h,foreach(index,getMacroGroup("Daily Attacks")), code: 
{
  [h:macroStr=json.get(getMacroProps(index,"json"),"label")]
  [h,if(endsWith(macroStr,"(Used)")): setMacroProps(index, "label="+replace(macroStr, " \\(Used\\)", ""))]
}]
[h,foreach(index,getMacroGroup("Daily Utilities")), code: 
{
  [h:macroStr=json.get(getMacroProps(index,"json"),"label")]
  [h,if(endsWith(macroStr,"(Used)")): setMacroProps(index, "label="+replace(macroStr, " \\(Used\\)", ""))]
}]
[h,foreach(index,getMacroGroup("Healing/Damage")), code: 
{
  [h:macroStr=json.get(getMacroProps(index,"json"),"label")]
  [h,if(endsWith(macroStr,"(Used)")): setMacroProps(index, "label="+replace(macroStr, " \\(Used\\)", ""))]
}]
[h:setAllStates(0)]
[h:updateProperty("MarkedBy","")]
[h:CurrentHP = MaxHP]
[h:TempHP = 0]
[h,macro("ClearDefMods@"+UseLib): ""]
[h:CurrentSurge = MaxSurge]
[h:MagicItemUses = 1]
[h:ActionPoints = 1]
[h,if(length(AttackBonuses)>0): AttackBonuses = ""]
[h,if(length(DamageBonuses)>0): DamageBonuses = ""]
[h,macro("ClearVulnResist@"+UseLib): ""]
[h,macro("ClearAtkDamMods@"+UseLib): ""]

[abort(0)]